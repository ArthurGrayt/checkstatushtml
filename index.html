<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Status</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 8px 12px;
            /* IMPORTANTE: Mude para a cor exata do seu app */
            background-color: #f1f4f8; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100vh;
            box-sizing: border-box;
        }

        .status-wrapper {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .service-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .left-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-name {
            font-size: 14px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #e0e0e0; /* Cinza inicial */
            box-shadow: 0 0 4px rgba(0,0,0,0.1);
            transition: background-color 0.4s ease;
        }

        /* Área de mensagem compacta */
        .message-box {
            margin-top: 12px;
            padding-top: 8px;
            border-top: 1px solid rgba(0,0,0,0.08);
            font-size: 11px;
            line-height: 1.3;
            color: #666;
            min-height: 28px;
        }

        /* Cores utilitárias */
        .status-text-danger { color: #d32f2f; font-weight: bold; }
        .status-text-warning { color: #f57c00; font-weight: bold; }
        .status-text-success { color: #2e7d32; }
    </style>
</head>
<body>

    <div class="status-wrapper">
        <div class="service-row">
            <div class="left-content">
                <div id="cf-dot" class="dot"></div>
                <span class="service-name">Cloudflare</span>
            </div>
        </div>

        <div class="service-row">
            <div class="left-content">
                <div id="sb-dot" class="dot"></div>
                <span class="service-name">Supabase</span>
            </div>
        </div>

        <div id="status-message" class="message-box">Iniciando diagnósticos...</div>
    </div>

    <script>
        // --- CONFIGURAÇÕES CRÍTICAS ---
        
        // 1. Cloudflare: Use um arquivo que com certeza existe no seu domínio
        const CF_URL = 'https://seu-dominio-aqui.com/favicon.ico'; 
        
        // 2. Supabase: Use APENAS a URL base do projeto (sem /auth, sem /rest)
        // Exemplo correto: https://xyzxyzxyz.supabase.co
        const SB_URL = 'https://seu-id-do-projeto.supabase.co'; 

        // Limites de tempo
        const TIMEOUT_LIMIT = 5000; // 5 segundos = Vermelho
        const LATENCY_LIMIT = 1500; // 1.5 segundos = Amarelo
        const CHECK_INTERVAL = 10000; // Rodar a cada 10s

        // Estado Global (0=OK, 1=Lento, 2=Erro)
        let cfState = 0; 
        let sbState = 0;

        async function pingUrl(url) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), TIMEOUT_LIMIT);
            const start = performance.now();

            try {
                // Tenta buscar. 'no-cors' é importante para não dar erro de segurança.
                await fetch(url + '?t=' + Date.now(), { 
                    mode: 'no-cors', 
                    signal: controller.signal 
                });
                
                // Se chegou aqui, o servidor respondeu (mesmo que seja 404, 401 ou 200)
                clearTimeout(timeoutId);
                const duration = performance.now() - start;
                
                // Retorna 1 se lento, 0 se rápido
                return duration > LATENCY_LIMIT ? 1 : 0;

            } catch (error) {
                clearTimeout(timeoutId);
                
                // AQUI ESTÁ A CORREÇÃO:
                // O erro "AbortError" significa Timeout real (Servidor caiu).
                if (error.name === 'AbortError') {
                    return 2; // Vermelho
                }

                // Qualquer outro erro (TypeError, Failed to Fetch) geralmente é 
                // o navegador bloqueando o script, mas o servidor está lá.
                // Assumimos que está online, mas contamos o tempo até o erro.
                const duration = performance.now() - start;
                return duration > LATENCY_LIMIT ? 1 : 0; 
            }
        }

        async function runChecks() {
            // Checa Cloudflare
            const cfResult = await pingUrl(CF_URL);
            updateDot('cf-dot', cfResult);
            cfState = cfResult;

            // Checa Supabase
            // DICA: Para o Supabase, adicionamos '/rest/v1/' para testar a API especificamente
            const sbResult = await pingUrl(SB_URL + '/rest/v1/');
            updateDot('sb-dot', sbResult);
            sbState = sbResult;

            updateMessage();
        }

        function updateDot(id, state) {
            const el = document.getElementById(id);
            if (state === 0) el.style.backgroundColor = '#4CAF50'; // Verde
            else if (state === 1) el.style.backgroundColor = '#FFC107'; // Amarelo
            else el.style.backgroundColor = '#F44336'; // Vermelho
        }

        function updateMessage() {
            const msgBox = document.getElementById('status-message');
            
            // Lógica de mensagens hierárquica
            if (cfState === 2 || sbState === 2) {
                msgBox.innerHTML = "⚠️ <span class='status-text-danger'>Instabilidade Crítica:</span> Um dos serviços está inacessível. Verifique sua conexão.";
            } else if (cfState === 1 && sbState === 1) {
                msgBox.innerHTML = "⏳ <span class='status-text-warning'>Atenção:</span> O sistema apresenta lentidão generalizada.";
            } else if (cfState === 1) {
                msgBox.innerHTML = "⏳ <span class='status-text-warning'>Nota:</span> O sistema pode apresentar lentidão por conta da Cloudflare.";
            } else if (sbState === 1) {
                msgBox.innerHTML = "⏳ <span class='status-text-warning'>Nota:</span> O banco de dados está respondendo com atraso.";
            } else {
                msgBox.innerHTML = "✅ <span class='status-text-success'>Sistema Operacional:</span> Todas as conexões estáveis.";
            }
        }

        // Loop
        runChecks();
        setInterval(runChecks, CHECK_INTERVAL);

    </script>
</body>
</html>